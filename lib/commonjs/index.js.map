{"version":3,"sources":["index.tsx"],"names":["height","screenHeight","Dimensions","get","P","android","ios","Platform","OS","magic","damping","mass","stiffness","overshootClamping","restSpeedThreshold","restDisplacementThreshold","deceleration","bouncyFactor","velocityFactor","toss","coefForTranslatingVelocities","set","cond","onChange","block","eq","greaterOrEq","sqrt","not","defined","max","add","and","Value","spring","or","divide","greaterThan","sub","event","diff","multiply","clockRunning","startClock","stopClock","decay","Clock","lessThan","call","lessOrEq","neq","Animated","runDecay","clock","value","velocity","wasStartedFromBegin","state","finished","position","time","config","withPreservingAdditiveOffset","drag","prev","valWithPreservedOffset","GestureState","BEGAN","withDecaying","decayClock","prevent","valDecayed","offset","END","ACTIVE","BottomSheetBehavior","React","Component","constructor","props","nativeEvent","translationY","dragMasterY","panMasterState","velocityY","masterVelocity","enabledInnerScrolling","dragY","panState","tapState","index","enabledImperativeSnapping","manuallySetValue","setValue","snapPoints","propsToNewIndices","setTimeout","isManuallySetValue","layout","heightOfHeader","heightOfHeaderAnimated","setState","requestAnimationFrame","heightOfContent","initSnap","panRef","innerGestureHandlerRefs","master","tapRef","getDerivedStateFromProps","undefined","init","middlesOfSnapPoints","i","length","tuple","push","masterOffseted","tossForMaster","springConfig","hasOwnProperty","destinationPoint","positive","currentSnapPoint","snapPoint","enabledBottomClamp","clampingValue","masterClock","prevMasterDrag","wasRun","translateMaster","CANCELLED","FAILED","runSpring","preventDecaying","masterClockForOverscroll","overdragResistanceFactor","Y","withEnhancedLimits","componentDidUpdate","_prevProps","prevState","dest","isManuallySet","valueToBeZeroed","toValue","val","wasRunMaster","min","limitedVal","diffPres","flagWasRunSpring","justEndedIfEnded","wasEndedMasterAfterInner","prevMaster","rev","sortedPropsSnapPoints","map","s","ind","renumber","Error","sort","a","b","forEach","__initialized","p","initialSnap","enabledBottomInitialAnimation","render","borderRadius","width","handleFullHeader","zIndex","opacity","transform","translateY","enabledGestureInteraction","enabledHeaderGestureInteraction","handleMasterPan","simultaneousHandlers","handleLayoutHeader","renderHeader","overflow","borderTopLeftRadius","borderTopRightRadius","enabledContentGestureInteraction","handlePan","enabledContentTapInteraction","handleTap","handleLayoutContent","renderContent","callbackNode","onOpenStart","onCloseEnd","callbackThreshold","onOpenStartValue","onCloseEndValue","onOpenEnd","onCloseStart","onOpenEndValue","onCloseStartValue","contentPosition","headerPosition","createRef","str","Number","split"],"mappings":"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","sourcesContent":["import * as React from 'react'\r\nimport { Dimensions, Platform, View, LayoutChangeEvent } from 'react-native'\r\nimport Animated from 'react-native-reanimated'\r\nimport {\r\n  PanGestureHandler,\r\n  TapGestureHandler,\r\n  State as GestureState,\r\n} from 'react-native-gesture-handler'\r\n\r\ntype Props = {\r\n  /**\r\n   * Points for snapping of bottom sheet component. They define distance from bottom of the screen.\r\n   * Might be number or percent (as string e.g. '20%') for points or percents of screen height from bottom.\r\n   */\r\n  snapPoints: (number | string)[]\r\n\r\n  /**\r\n   * Determines initial snap point of bottom sheet. Defaults to 0.\r\n   */\r\n  initialSnap: number\r\n\r\n  /**\r\n   * Method for rendering scrollable content of bottom sheet.\r\n   */\r\n  renderContent?: () => React.ReactNode\r\n\r\n  /**\r\n   * Method for rendering non-scrollable header of bottom sheet.\r\n   */\r\n  renderHeader?: () => React.ReactNode\r\n\r\n  /**\r\n   * Defines if bottom sheet could be scrollable by gesture. Defaults to true.\r\n   */\r\n  enabledGestureInteraction?: boolean\r\n  enabledHeaderGestureInteraction?: boolean\r\n  enabledContentGestureInteraction?: boolean\r\n\r\n  /**\r\n   * Defines if bottom sheet content responds to taps. Defaults to true.\r\n   */\r\n  enabledContentTapInteraction?: boolean\r\n\r\n  /**\r\n   * When true, clamp bottom position to first snapPoint.\r\n   */\r\n  enabledBottomClamp?: boolean\r\n\r\n  /**\r\n   * When true, sheet will grows up from bottom to initial snapPoint.\r\n   */\r\n  enabledBottomInitialAnimation?: boolean\r\n\r\n  /**\r\n   * If false blocks snapping using snapTo method. Defaults to true.\r\n   */\r\n  enabledManualSnapping?: boolean\r\n\r\n  /**\r\n   * Defines whether it's possible to scroll inner content of bottom sheet. Defaults to true.\r\n   */\r\n  enabledInnerScrolling?: boolean\r\n\r\n  /**\r\n   * Reanimated node which holds position of bottom sheet, where 1 it the highest snap point and 0 is the lowest.\r\n   */\r\n  callbackNode?: Animated.Value<number>\r\n\r\n  /**\r\n   * Reanimated node which holds position of bottom sheet;s content (in dp).\r\n   */\r\n  contentPosition?: Animated.Value<number>\r\n\r\n  /**\r\n   * Reanimated node which holds position of bottom sheet's header (in dp).\r\n   */\r\n  headerPosition?: Animated.Value<number>\r\n\r\n  /**\r\n   * Defines how violently sheet has to stopped while overdragging. 0 means no overdrag. Defaults to 0.\r\n   */\r\n  overdragResistanceFactor: number\r\n\r\n  /**\r\n   * Array of Refs passed to gesture handlers for simultaneous event handling\r\n   */\r\n  simultaneousHandlers?: Array<React.RefObject<any>> | React.RefObject<any>\r\n\r\n  /**\r\n   * Overrides config for spring animation\r\n   */\r\n  springConfig: {\r\n    damping?: number\r\n    mass?: number\r\n    stiffness?: number\r\n    restSpeedThreshold?: number\r\n    restDisplacementThreshold?: number\r\n    toss?: number\r\n  }\r\n\r\n  /**\r\n   * Refs for gesture handlers used for building bottomsheet\r\n   */\r\n  innerGestureHandlerRefs: [\r\n    React.RefObject<PanGestureHandler>,\r\n    React.RefObject<PanGestureHandler>,\r\n    React.RefObject<TapGestureHandler>\r\n  ]\r\n\r\n  enabledImperativeSnapping?: boolean\r\n\r\n  onOpenStart?: () => void\r\n  onOpenEnd?: () => void\r\n  onCloseStart?: () => void\r\n  onCloseEnd?: () => void\r\n  callbackThreshold?: number\r\n  borderRadius?: number\r\n}\r\n\r\ntype State = {\r\n  snapPoints: Animated.Value<number>[]\r\n  init: any\r\n  initSnap: number\r\n  propsToNewIndices: { [key: string]: number }\r\n  heightOfContent: Animated.Value<number>\r\n  heightOfHeader: number\r\n  heightOfHeaderAnimated: Animated.Value<number>\r\n}\r\n\r\nconst { height: screenHeight } = Dimensions.get('window')\r\n\r\nconst P = <T extends any>(android: T, ios: T): T =>\r\n  Platform.OS === 'ios' ? ios : android\r\n\r\nconst magic = {\r\n  damping: 50,\r\n  mass: 0.3,\r\n  stiffness: 121.6,\r\n  overshootClamping: true,\r\n  restSpeedThreshold: 0.3,\r\n  restDisplacementThreshold: 0.3,\r\n  deceleration: 0.999,\r\n  bouncyFactor: 1,\r\n  velocityFactor: P(1, 0.8),\r\n  toss: 0.4,\r\n  coefForTranslatingVelocities: 5,\r\n}\r\n\r\nconst {\r\n  damping,\r\n  mass,\r\n  stiffness,\r\n  overshootClamping,\r\n  restSpeedThreshold,\r\n  restDisplacementThreshold,\r\n  deceleration,\r\n  velocityFactor,\r\n  toss,\r\n} = magic\r\n\r\nconst {\r\n  set,\r\n  cond,\r\n  onChange,\r\n  block,\r\n  eq,\r\n  greaterOrEq,\r\n  sqrt,\r\n  not,\r\n  defined,\r\n  max,\r\n  add,\r\n  and,\r\n  Value,\r\n  spring,\r\n  or,\r\n  divide,\r\n  greaterThan,\r\n  sub,\r\n  event,\r\n  diff,\r\n  multiply,\r\n  clockRunning,\r\n  startClock,\r\n  stopClock,\r\n  decay,\r\n  Clock,\r\n  lessThan,\r\n  call,\r\n  lessOrEq,\r\n  neq,\r\n} = Animated\r\n\r\nfunction runDecay(\r\n  clock: Animated.Clock,\r\n  value: Animated.Node<number>,\r\n  velocity: Animated.Node<number>,\r\n  wasStartedFromBegin: Animated.Value<number>\r\n) {\r\n  const state = {\r\n    finished: new Value(0),\r\n    velocity: new Value(0),\r\n    position: new Value(0),\r\n    time: new Value(0),\r\n  }\r\n\r\n  const config = { deceleration }\r\n\r\n  return [\r\n    cond(clockRunning(clock), 0, [\r\n      cond(wasStartedFromBegin, 0, [\r\n        set(wasStartedFromBegin, 1),\r\n        set(state.finished, 0),\r\n        set(state.velocity, multiply(velocity, velocityFactor)),\r\n        set(state.position, value),\r\n        set(state.time, 0),\r\n        startClock(clock),\r\n      ]),\r\n    ]),\r\n    cond(clockRunning(clock), decay(clock, state, config)),\r\n    cond(state.finished, stopClock(clock)),\r\n    state.position,\r\n  ]\r\n}\r\n\r\nfunction withPreservingAdditiveOffset(\r\n  drag: Animated.Node<number>,\r\n  state: Animated.Node<number>\r\n) {\r\n  const prev = new Value(0)\r\n  const valWithPreservedOffset = new Value(0)\r\n  return block([\r\n    cond(\r\n      eq(state, GestureState.BEGAN),\r\n      [set(prev, 0)],\r\n      [\r\n        set(\r\n          valWithPreservedOffset,\r\n          add(valWithPreservedOffset, sub(drag, prev))\r\n        ),\r\n        set(prev, drag),\r\n      ]\r\n    ),\r\n    valWithPreservedOffset,\r\n  ])\r\n}\r\n\r\nfunction withDecaying(\r\n  drag: Animated.Node<number>,\r\n  state: Animated.Node<number>,\r\n  decayClock: Animated.Clock,\r\n  velocity: Animated.Node<number>,\r\n  prevent: Animated.Value<number>\r\n) {\r\n  const valDecayed = new Value(0)\r\n  const offset = new Value(0)\r\n  // since there might be moar than one clock\r\n  const wasStartedFromBegin = new Value(0)\r\n  return block([\r\n    cond(\r\n      eq(state, GestureState.END),\r\n      [\r\n        cond(\r\n          prevent,\r\n          stopClock(decayClock),\r\n          set(\r\n            valDecayed,\r\n            runDecay(\r\n              decayClock,\r\n              add(drag, offset),\r\n              velocity,\r\n              wasStartedFromBegin\r\n            )\r\n          )\r\n        ),\r\n      ],\r\n      [\r\n        stopClock(decayClock),\r\n        cond(eq(state, GestureState.BEGAN), set(prevent, 0)),\r\n        cond(\r\n          or(eq(state, GestureState.BEGAN), eq(state, GestureState.ACTIVE)),\r\n          set(wasStartedFromBegin, 0)\r\n        ),\r\n        cond(eq(state, GestureState.BEGAN), [\r\n          set(offset, sub(valDecayed, drag)),\r\n        ]),\r\n        set(valDecayed, add(drag, offset)),\r\n      ]\r\n    ),\r\n    valDecayed,\r\n  ])\r\n}\r\n\r\nexport default class BottomSheetBehavior extends React.Component<Props, State> {\r\n  static defaultProps = {\r\n    overdragResistanceFactor: 0,\r\n    initialSnap: 0,\r\n    enabledImperativeSnapping: true,\r\n    enabledGestureInteraction: true,\r\n    enabledBottomClamp: false,\r\n    enabledBottomInitialAnimation: false,\r\n    enabledHeaderGestureInteraction: true,\r\n    enabledContentGestureInteraction: true,\r\n    enabledContentTapInteraction: true,\r\n    enabledInnerScrolling: true,\r\n    springConfig: {},\r\n    innerGestureHandlerRefs: [\r\n      React.createRef(),\r\n      React.createRef(),\r\n      React.createRef(),\r\n    ],\r\n    callbackThreshold: 0.01,\r\n  }\r\n\r\n  private decayClock = new Clock()\r\n  private panState = new Value(0)\r\n  private tapState = new Value(0)\r\n  private velocity = new Value(0)\r\n  private panMasterState: Animated.Value<number> = new Value(GestureState.END)\r\n  private masterVelocity = new Value(0)\r\n  private isManuallySetValue: Animated.Value<number> = new Value(0)\r\n  private manuallySetValue = new Value(0)\r\n  private masterClockForOverscroll = new Clock()\r\n  private preventDecaying: Animated.Value<number> = new Value(0)\r\n  private dragMasterY = new Value(0)\r\n  private dragY = new Value(0)\r\n  private translateMaster: Animated.Node<number>\r\n  private panRef: React.RefObject<PanGestureHandler>\r\n  private master: React.RefObject<PanGestureHandler>\r\n  private tapRef: React.RefObject<TapGestureHandler>\r\n  private snapPoint: Animated.Node<number>\r\n  private Y: Animated.Node<number>\r\n  private clampingValue: Animated.Value<number> = new Value(0)\r\n  private onOpenStartValue: Animated.Value<number> = new Value(0)\r\n  private onOpenEndValue: Animated.Value<number> = new Value(0)\r\n  private onCloseStartValue: Animated.Value<number> = new Value(1)\r\n  private onCloseEndValue: Animated.Value<number> = new Value(0)\r\n\r\n  constructor(props: Props) {\r\n    super(props)\r\n\r\n    this.panRef = props.innerGestureHandlerRefs[0]\r\n    this.master = props.innerGestureHandlerRefs[1]\r\n    this.tapRef = props.innerGestureHandlerRefs[2]\r\n    this.state = BottomSheetBehavior.getDerivedStateFromProps(props, undefined)\r\n\r\n    const { snapPoints, init } = this.state\r\n    const middlesOfSnapPoints: [\r\n      Animated.Node<number>,\r\n      Animated.Node<number>\r\n    ][] = []\r\n\r\n    for (let i = 1; i < snapPoints.length; i++) {\r\n      const tuple: [Animated.Node<number>, Animated.Node<number>] = [\r\n        add(snapPoints[i - 1], 10),\r\n        sub(snapPoints[i], 25),\r\n      ]\r\n      middlesOfSnapPoints.push(tuple)\r\n    }\r\n\r\n    const masterOffseted = new Value(init)\r\n    // destination point is a approximation of movement if finger released\r\n    const tossForMaster =\r\n      props.springConfig.hasOwnProperty('toss') &&\r\n      props.springConfig.toss != undefined\r\n        ? props.springConfig.toss\r\n        : toss\r\n    const destinationPoint = add(\r\n      masterOffseted,\r\n      multiply(tossForMaster, this.masterVelocity)\r\n    )\r\n\r\n    const positive = greaterOrEq(\r\n      multiply(tossForMaster, this.masterVelocity),\r\n      0\r\n    )\r\n    // method for generating condition for finding the nearest snap point\r\n    const currentSnapPoint = (i = 0): Animated.Node<number> =>\r\n      i + 1 === snapPoints.length\r\n        ? snapPoints[i]\r\n        : cond(\r\n            positive,\r\n            cond(\r\n              greaterThan(destinationPoint, middlesOfSnapPoints[i][0]),\r\n              cond(\r\n                lessThan(destinationPoint, middlesOfSnapPoints[i][1]),\r\n                snapPoints[i + 1],\r\n                currentSnapPoint(i + 1)\r\n              ),\r\n              snapPoints[i]\r\n            ),\r\n            cond(\r\n              greaterThan(destinationPoint, middlesOfSnapPoints[i][1]),\r\n              cond(\r\n                lessThan(destinationPoint, middlesOfSnapPoints[i][0]),\r\n                snapPoints[i + 1],\r\n                currentSnapPoint(i + 1)\r\n              ),\r\n              snapPoints[i]\r\n            )\r\n          )\r\n    // current snap point desired\r\n    this.snapPoint = currentSnapPoint()\r\n\r\n    if (props.enabledBottomClamp) {\r\n      this.clampingValue.setValue(snapPoints[snapPoints.length - 1])\r\n    }\r\n\r\n    const masterClock = new Clock()\r\n    const prevMasterDrag = new Value(0)\r\n    const wasRun: Animated.Value<number> = new Value(0)\r\n    this.translateMaster = block([\r\n      cond(\r\n        or(\r\n          eq(this.panMasterState, GestureState.END),\r\n          eq(this.panMasterState, GestureState.CANCELLED),\r\n          eq(this.panMasterState, GestureState.FAILED)\r\n        ),\r\n        [\r\n          set(prevMasterDrag, 0),\r\n          cond(\r\n            or(clockRunning(masterClock), not(wasRun), this.isManuallySetValue),\r\n            [\r\n              cond(this.isManuallySetValue, stopClock(masterClock)),\r\n              set(\r\n                masterOffseted,\r\n                this.runSpring(\r\n                  masterClock,\r\n                  masterOffseted,\r\n                  this.masterVelocity,\r\n                  cond(\r\n                    this.isManuallySetValue,\r\n                    this.manuallySetValue,\r\n                    this.snapPoint\r\n                  ),\r\n                  wasRun,\r\n                  this.isManuallySetValue,\r\n                  this.masterVelocity\r\n                )\r\n              ),\r\n              set(this.isManuallySetValue, 0),\r\n            ]\r\n          ),\r\n        ],\r\n        [\r\n          stopClock(masterClock),\r\n          set(this.preventDecaying, 1),\r\n          set(\r\n            masterOffseted,\r\n            add(masterOffseted, sub(this.dragMasterY, prevMasterDrag))\r\n          ),\r\n          set(prevMasterDrag, this.dragMasterY),\r\n          set(wasRun, 0), // not sure about this move for cond-began\r\n          cond(\r\n            eq(this.panMasterState, GestureState.BEGAN),\r\n            stopClock(this.masterClockForOverscroll)\r\n          ),\r\n        ]\r\n      ),\r\n      cond(\r\n        greaterThan(masterOffseted, snapPoints[0]),\r\n        cond(\r\n          and(\r\n            props.enabledBottomClamp ? 1 : 0,\r\n            greaterThan(masterOffseted, this.clampingValue)\r\n          ),\r\n          this.clampingValue,\r\n          masterOffseted\r\n        ),\r\n        max(\r\n          multiply(\r\n            sub(\r\n              snapPoints[0],\r\n              sqrt(add(1, sub(snapPoints[0], masterOffseted)))\r\n            ),\r\n            !props.enabledInnerScrolling ? props.overdragResistanceFactor : 0\r\n          ),\r\n          masterOffseted\r\n        )\r\n      ),\r\n    ])\r\n\r\n    this.Y = this.withEnhancedLimits(\r\n      withDecaying(\r\n        withPreservingAdditiveOffset(this.dragY, this.panState),\r\n        this.panState,\r\n        this.decayClock,\r\n        this.velocity,\r\n        this.preventDecaying\r\n      ),\r\n      masterOffseted\r\n    )\r\n  }\r\n\r\n  componentDidUpdate(_prevProps: Props, prevState: State) {\r\n    const { snapPoints } = this.state\r\n    if (this.props.enabledBottomClamp && snapPoints !== prevState.snapPoints) {\r\n      this.clampingValue.setValue(snapPoints[snapPoints.length - 1])\r\n    }\r\n  }\r\n\r\n  private runSpring(\r\n    clock: Animated.Clock,\r\n    value: Animated.Value<number>,\r\n    velocity: Animated.Node<number>,\r\n    dest: Animated.Node<number>,\r\n    wasRun: Animated.Value<number>,\r\n    isManuallySet: Animated.Node<number> | number,\r\n    valueToBeZeroed: Animated.Value<number>\r\n  ) {\r\n    const state = {\r\n      finished: new Value(0),\r\n      velocity: new Value(0),\r\n      position: new Value(0),\r\n      time: new Value(0),\r\n    }\r\n\r\n    const config = {\r\n      damping,\r\n      mass,\r\n      stiffness,\r\n      overshootClamping,\r\n      restSpeedThreshold,\r\n      restDisplacementThreshold,\r\n      toValue: new Value(0),\r\n      ...this.props.springConfig,\r\n    }\r\n\r\n    return [\r\n      cond(clockRunning(clock), 0, [\r\n        set(state.finished, 0),\r\n        set(state.velocity, velocity),\r\n        set(state.position, value),\r\n        set(config.toValue, dest),\r\n        cond(and(wasRun, not(isManuallySet)), 0, startClock(clock)),\r\n        cond(defined(wasRun), set(wasRun, 1)),\r\n      ]),\r\n      spring(clock, state, config),\r\n      cond(state.finished, [stopClock(clock), set(valueToBeZeroed, 0)]),\r\n      state.position,\r\n    ]\r\n  }\r\n\r\n  private handleMasterPan = event([\r\n    {\r\n      nativeEvent: {\r\n        translationY: this.dragMasterY,\r\n        state: this.panMasterState,\r\n        velocityY: this.masterVelocity,\r\n      },\r\n    },\r\n  ])\r\n\r\n  private handlePan = event([\r\n    {\r\n      nativeEvent: {\r\n        translationY: this.props.enabledInnerScrolling\r\n          ? this.dragY\r\n          : this.dragMasterY,\r\n        state: this.props.enabledInnerScrolling\r\n          ? this.panState\r\n          : this.panMasterState,\r\n        velocityY: this.props.enabledInnerScrolling\r\n          ? this.velocity\r\n          : this.masterVelocity,\r\n      },\r\n    },\r\n  ])\r\n\r\n  private handleTap = event([{ nativeEvent: { state: this.tapState } }])\r\n\r\n  private withEnhancedLimits(\r\n    val: Animated.Node<number>,\r\n    masterOffseted: Animated.Value<number>\r\n  ) {\r\n    const wasRunMaster = new Value(0)\r\n    const min = multiply(\r\n      -1,\r\n      add(this.state.heightOfContent, this.state.heightOfHeaderAnimated)\r\n    )\r\n    const prev = new Value(0)\r\n    const limitedVal = new Value(0)\r\n    const diffPres = new Value(0)\r\n    const flagWasRunSpring = new Value(0)\r\n    const justEndedIfEnded: Animated.Value<number> = new Value(1)\r\n    const wasEndedMasterAfterInner: Animated.Value<number> = new Value(1)\r\n    const prevMaster = new Value(1)\r\n    const prevState = new Value(0)\r\n    const rev = new Value(0)\r\n\r\n    return block([\r\n      set(rev, limitedVal),\r\n      cond(\r\n        or(\r\n          eq(this.panState, GestureState.BEGAN),\r\n          and(\r\n            eq(this.panState, GestureState.ACTIVE),\r\n            eq(prevState, GestureState.END)\r\n          )\r\n        ),\r\n        [\r\n          set(prev, val),\r\n          set(flagWasRunSpring, 0),\r\n          stopClock(this.masterClockForOverscroll),\r\n          set(wasRunMaster, 0),\r\n        ],\r\n        [\r\n          set(limitedVal, add(limitedVal, sub(val, prev))),\r\n          cond(lessThan(limitedVal, min), set(limitedVal, min)),\r\n        ]\r\n      ),\r\n      set(prevState, this.panState), // on iOS sometimes BEGAN event does not trigger\r\n      set(diffPres, sub(prev, val)),\r\n      set(prev, val),\r\n      cond(\r\n        or(greaterOrEq(limitedVal, 0), greaterThan(masterOffseted, 0)),\r\n        [\r\n          cond(\r\n            eq(this.panState, GestureState.ACTIVE),\r\n            set(masterOffseted, sub(masterOffseted, diffPres))\r\n          ),\r\n          cond(greaterThan(masterOffseted, 0), [set(limitedVal, 0)]),\r\n          cond(\r\n            not(eq(this.panState, GestureState.END)),\r\n            set(justEndedIfEnded, 1)\r\n          ),\r\n          cond(\r\n            or(\r\n              eq(this.panState, GestureState.ACTIVE),\r\n              eq(this.panMasterState, GestureState.ACTIVE)\r\n            ),\r\n            set(wasEndedMasterAfterInner, 0)\r\n          ),\r\n          cond(\r\n            and(\r\n              eq(prevMaster, GestureState.ACTIVE),\r\n              eq(this.panMasterState, GestureState.END),\r\n              eq(this.panState, GestureState.END)\r\n            ),\r\n            set(wasEndedMasterAfterInner, 1)\r\n          ),\r\n          set(prevMaster, this.panMasterState),\r\n          cond(\r\n            and(\r\n              eq(this.panState, GestureState.END),\r\n              not(wasEndedMasterAfterInner),\r\n              not(eq(this.panMasterState, GestureState.ACTIVE)),\r\n              not(eq(this.panMasterState, GestureState.BEGAN)),\r\n              or(clockRunning(this.masterClockForOverscroll), not(wasRunMaster))\r\n            ),\r\n            [\r\n              // cond(justEndedIfEnded, set(this.masterVelocity, diff(val))),\r\n              set(\r\n                this.masterVelocity,\r\n                cond(justEndedIfEnded, diff(val), this.velocity)\r\n              ),\r\n              set(\r\n                masterOffseted,\r\n                this.runSpring(\r\n                  this.masterClockForOverscroll,\r\n                  masterOffseted,\r\n                  diff(val),\r\n                  this.snapPoint,\r\n                  wasRunMaster,\r\n                  0,\r\n                  this.masterVelocity\r\n                )\r\n              ),\r\n              set(this.masterVelocity, 0),\r\n            ]\r\n          ),\r\n          //   cond(eq(this.panState, State.END), set(wasEndedMasterAfterInner, 0)),\r\n          cond(eq(this.panState, GestureState.END), set(justEndedIfEnded, 0)),\r\n          set(this.preventDecaying, 1),\r\n          0,\r\n        ],\r\n        [set(this.preventDecaying, 0), limitedVal]\r\n      ),\r\n    ])\r\n  }\r\n\r\n  snapTo = (index: number) => {\r\n    if (!this.props.enabledImperativeSnapping) {\r\n      return\r\n    }\r\n    this.manuallySetValue.setValue(\r\n      // @ts-ignore\r\n      this.state.snapPoints[this.state.propsToNewIndices[index]]\r\n    )\r\n    setTimeout(() => this.isManuallySetValue.setValue(1), 0);\r\n  }\r\n\r\n  private height: Animated.Value<number> = new Value(0)\r\n\r\n  private handleLayoutHeader = ({\r\n    nativeEvent: {\r\n      layout: { height: heightOfHeader },\r\n    },\r\n  }: LayoutChangeEvent) => {\r\n    this.state.heightOfHeaderAnimated.setValue(heightOfHeader)\r\n    this.setState({ heightOfHeader })\r\n  }\r\n\r\n  private handleFullHeader = ({\r\n    nativeEvent: {\r\n      layout: { height },\r\n    },\r\n  }: LayoutChangeEvent) =>\r\n    requestAnimationFrame(() => this.height.setValue(height))\r\n\r\n  private handleLayoutContent = ({\r\n    nativeEvent: {\r\n      layout: { height },\r\n    },\r\n  }: LayoutChangeEvent) =>\r\n    this.state.heightOfContent.setValue(height - this.state.initSnap)\r\n\r\n  static renumber = (str: string) =>\r\n    (Number(str.split('%')[0]) * screenHeight) / 100\r\n\r\n  static getDerivedStateFromProps(\r\n    props: Props,\r\n    state: State | undefined\r\n  ): State {\r\n    let snapPoints\r\n    const sortedPropsSnapPoints: Array<{\r\n      val: number\r\n      ind: number\r\n    }> = props.snapPoints\r\n      .map(\r\n        (\r\n          s: number | string,\r\n          i: number\r\n        ): {\r\n          val: number\r\n          ind: number\r\n        } => {\r\n          if (typeof s === 'number') {\r\n            return { val: s, ind: i }\r\n          } else if (typeof s === 'string') {\r\n            return { val: BottomSheetBehavior.renumber(s), ind: i }\r\n          }\r\n\r\n          throw new Error(`Invalid type for value ${s}: ${typeof s}`)\r\n        }\r\n      )\r\n      .sort(({ val: a }, { val: b }) => b - a)\r\n    if (state && state.snapPoints) {\r\n      state.snapPoints.forEach(\r\n        (s, i) =>\r\n          // @ts-ignore\r\n          s.__initialized &&\r\n          s.setValue(\r\n            sortedPropsSnapPoints[0].val - sortedPropsSnapPoints[i].val\r\n          )\r\n      )\r\n      snapPoints = state.snapPoints\r\n    } else {\r\n      snapPoints = sortedPropsSnapPoints.map(\r\n        p => new Value(sortedPropsSnapPoints[0].val - p.val)\r\n      )\r\n    }\r\n\r\n    const propsToNewIndices: { [key: string]: number } = {}\r\n    sortedPropsSnapPoints.forEach(({ ind }, i) => (propsToNewIndices[ind] = i))\r\n\r\n    const { initialSnap } = props\r\n\r\n    let init =\r\n      sortedPropsSnapPoints[0].val -\r\n      sortedPropsSnapPoints[propsToNewIndices[initialSnap]].val\r\n\r\n    if (props.enabledBottomInitialAnimation) {\r\n      init =\r\n        sortedPropsSnapPoints[\r\n          sortedPropsSnapPoints.length - 1 - propsToNewIndices[initialSnap]\r\n        ].val\r\n    }\r\n\r\n    return {\r\n      init,\r\n      propsToNewIndices,\r\n      heightOfHeaderAnimated:\r\n        (state && state.heightOfHeaderAnimated) || new Value(0),\r\n      heightOfContent: (state && state.heightOfContent) || new Value(0),\r\n      initSnap: sortedPropsSnapPoints[0].val,\r\n      snapPoints,\r\n      heightOfHeader: (state && state.heightOfHeader) || 0,\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { borderRadius } = this.props\r\n    return (\r\n      <React.Fragment>\r\n        <Animated.View\r\n          style={{\r\n            height: '100%',\r\n            width: 0,\r\n            position: 'absolute',\r\n          }}\r\n          onLayout={this.handleFullHeader}\r\n        />\r\n        <Animated.View\r\n          style={{\r\n            width: '100%',\r\n            position: 'absolute',\r\n            zIndex: 100,\r\n            opacity: cond(this.height, 1, 0),\r\n            transform: [\r\n              {\r\n                translateY: this.translateMaster,\r\n              },\r\n              {\r\n                translateY: sub(this.height, this.state.initSnap) as any,\r\n              },\r\n            ],\r\n          }}\r\n        >\r\n          <PanGestureHandler\r\n            enabled={\r\n              this.props.enabledGestureInteraction &&\r\n              this.props.enabledHeaderGestureInteraction\r\n            }\r\n            ref={this.master}\r\n            waitFor={this.panRef}\r\n            onGestureEvent={this.handleMasterPan}\r\n            onHandlerStateChange={this.handleMasterPan}\r\n            simultaneousHandlers={this.props.simultaneousHandlers}\r\n          >\r\n            <Animated.View\r\n              style={{\r\n                zIndex: 101,\r\n              }}\r\n              onLayout={this.handleLayoutHeader}\r\n            >\r\n              {this.props.renderHeader && this.props.renderHeader()}\r\n            </Animated.View>\r\n          </PanGestureHandler>\r\n          <View\r\n            style={\r\n              this.props.enabledInnerScrolling && {\r\n                height: this.state.initSnap - this.state.heightOfHeader,\r\n                overflow: 'hidden',\r\n                borderTopLeftRadius: borderRadius,\r\n                borderTopRightRadius: borderRadius,\r\n              }\r\n            }\r\n          >\r\n            <PanGestureHandler\r\n              enabled={\r\n                this.props.enabledGestureInteraction &&\r\n                this.props.enabledContentGestureInteraction\r\n              }\r\n              waitFor={this.master}\r\n              ref={this.panRef}\r\n              onGestureEvent={this.handlePan}\r\n              onHandlerStateChange={this.handlePan}\r\n              simultaneousHandlers={this.props.simultaneousHandlers}\r\n            >\r\n              <Animated.View>\r\n                <TapGestureHandler\r\n                  ref={this.tapRef}\r\n                  enabled={\r\n                    this.props.enabledGestureInteraction &&\r\n                    this.props.enabledContentGestureInteraction &&\r\n                    this.props.enabledContentTapInteraction\r\n                  }\r\n                  onHandlerStateChange={this.handleTap}\r\n                  simultaneousHandlers={this.props.simultaneousHandlers}\r\n                >\r\n                  <Animated.View\r\n                    style={{\r\n                      width: '100%',\r\n                      transform: [{ translateY: this.Y as any }],\r\n                    }}\r\n                    onLayout={this.handleLayoutContent}\r\n                  >\r\n                    {this.props.renderContent && this.props.renderContent()}\r\n                  </Animated.View>\r\n                </TapGestureHandler>\r\n              </Animated.View>\r\n            </PanGestureHandler>\r\n            <Animated.Code\r\n              exec={onChange(\r\n                this.tapState,\r\n                cond(\r\n                  eq(this.tapState, GestureState.BEGAN),\r\n                  stopClock(this.decayClock)\r\n                )\r\n              )}\r\n            />\r\n            {this.props.callbackNode && (\r\n              <Animated.Code\r\n                exec={onChange(\r\n                  this.translateMaster,\r\n                  set(\r\n                    this.props.callbackNode,\r\n                    divide(\r\n                      this.translateMaster,\r\n                      this.state.snapPoints[this.state.snapPoints.length - 1]\r\n                    )\r\n                  )\r\n                )}\r\n              />\r\n            )}\r\n            {(this.props.onOpenStart || this.props.onCloseEnd) && (\r\n              <Animated.Code\r\n                exec={onChange(this.translateMaster, [\r\n                  cond(\r\n                    and(\r\n                      lessOrEq(\r\n                        divide(\r\n                          this.translateMaster,\r\n                          this.state.snapPoints[\r\n                            this.state.snapPoints.length - 1\r\n                          ]\r\n                        ),\r\n                        1 -\r\n                          (this.props.callbackThreshold\r\n                            ? this.props.callbackThreshold\r\n                            : 0.01)\r\n                      ),\r\n                      neq(this.onOpenStartValue, 1)\r\n                    ),\r\n                    [\r\n                      call([], () => {\r\n                        if (this.props.onOpenStart) this.props.onOpenStart()\r\n                      }),\r\n                      set(this.onOpenStartValue, 1),\r\n                      cond(\r\n                        defined(this.onCloseEndValue),\r\n                        set(this.onCloseEndValue, 0)\r\n                      ),\r\n                    ]\r\n                  ),\r\n                ])}\r\n              />\r\n            )}\r\n            {(this.props.onOpenEnd || this.props.onCloseStart) && (\r\n              <Animated.Code\r\n                exec={onChange(this.translateMaster, [\r\n                  cond(\r\n                    and(\r\n                      lessOrEq(\r\n                        divide(\r\n                          this.translateMaster,\r\n                          this.state.snapPoints[\r\n                            this.state.snapPoints.length - 1\r\n                          ]\r\n                        ),\r\n                        this.props.callbackThreshold\r\n                          ? this.props.callbackThreshold\r\n                          : 0.01\r\n                      ),\r\n                      neq(this.onOpenEndValue, 1)\r\n                    ),\r\n                    [\r\n                      call([], () => {\r\n                        if (this.props.onOpenEnd) this.props.onOpenEnd()\r\n                      }),\r\n                      set(this.onOpenEndValue, 1),\r\n                      cond(\r\n                        defined(this.onCloseStartValue),\r\n                        set(this.onCloseStartValue, 0)\r\n                      ),\r\n                    ]\r\n                  ),\r\n                ])}\r\n              />\r\n            )}\r\n            {(this.props.onCloseStart || this.props.onOpenEnd) && (\r\n              <Animated.Code\r\n                exec={onChange(this.translateMaster, [\r\n                  cond(\r\n                    and(\r\n                      greaterOrEq(\r\n                        divide(\r\n                          this.translateMaster,\r\n                          this.state.snapPoints[\r\n                            this.state.snapPoints.length - 1\r\n                          ]\r\n                        ),\r\n                        this.props.callbackThreshold\r\n                          ? this.props.callbackThreshold\r\n                          : 0.01\r\n                      ),\r\n                      neq(this.onCloseStartValue, 1)\r\n                    ),\r\n                    [\r\n                      call([], () => {\r\n                        if (this.props.onCloseStart) this.props.onCloseStart()\r\n                      }),\r\n                      set(this.onCloseStartValue, 1),\r\n                      cond(\r\n                        defined(this.onCloseStartValue),\r\n                        set(this.onOpenEndValue, 0)\r\n                      ),\r\n                    ]\r\n                  ),\r\n                ])}\r\n              />\r\n            )}\r\n            {(this.props.onCloseEnd || this.props.onOpenStart) && (\r\n              <Animated.Code\r\n                exec={onChange(this.translateMaster, [\r\n                  cond(\r\n                    and(\r\n                      greaterOrEq(\r\n                        divide(\r\n                          this.translateMaster,\r\n                          this.state.snapPoints[\r\n                            this.state.snapPoints.length - 1\r\n                          ]\r\n                        ),\r\n                        1 -\r\n                          (this.props.callbackThreshold\r\n                            ? this.props.callbackThreshold\r\n                            : 0.01)\r\n                      ),\r\n                      neq(this.onCloseEndValue, 1)\r\n                    ),\r\n                    [\r\n                      call([], () => {\r\n                        if (this.props.onCloseEnd) this.props.onCloseEnd()\r\n                      }),\r\n                      set(this.onCloseEndValue, 1),\r\n                      cond(\r\n                        defined(this.onOpenStartValue),\r\n                        set(this.onOpenStartValue, 0)\r\n                      ),\r\n                      cond(\r\n                        defined(this.onOpenEndValue),\r\n                        set(this.onOpenEndValue, 0)\r\n                      ),\r\n                    ]\r\n                  ),\r\n                ])}\r\n              />\r\n            )}\r\n            {this.props.contentPosition && (\r\n              <Animated.Code\r\n                exec={onChange(\r\n                  this.Y,\r\n                  set(this.props.contentPosition, sub(0, this.Y))\r\n                )}\r\n              />\r\n            )}\r\n            {this.props.headerPosition && (\r\n              <Animated.Code\r\n                exec={onChange(\r\n                  this.translateMaster,\r\n                  set(this.props.headerPosition, this.translateMaster)\r\n                )}\r\n              />\r\n            )}\r\n          </View>\r\n        </Animated.View>\r\n      </React.Fragment>\r\n    )\r\n  }\r\n}\r\n"]}